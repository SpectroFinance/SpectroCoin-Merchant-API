<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>SpectroCoin Merchant API by SpectroFinance</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">SpectroCoin Merchant API</h1>
      <h2 class="project-tagline">SpectroCoin Bitcoin Merchant PHP plugin</h2>
      <a href="https://github.com/SpectroFinance/SpectroCoin-Merchant-API" class="btn">View on GitHub</a>
      <a href="https://github.com/SpectroFinance/SpectroCoin-Merchant-API/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/SpectroFinance/SpectroCoin-Merchant-API/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="spectrocoin-merchant-api" class="anchor" href="#spectrocoin-merchant-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>SpectroCoin Merchant API</h1>

<p>This document describes <a href="https://spectrocoin.com">SpectroCoin</a> merchant service API specification.</p>

<h1>
<a id="contents" class="anchor" href="#contents" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contents</h1>

<ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#api">API</a></li>
<li><a href="#signature">Signature</a></li>
<li><a href="#example-applications">Example applications</a></li>
</ul>

<h1>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h1>

<ul>
<li>Must have a SpectroCoin account (<a href="https://spectrocoin.com/en/signup.html">Sign Up!</a>) to setup and test API. For merchant API usage in production you must approve your account.</li>
<li>Must <a href="#merchant-key-pair">generate</a> private and public key pairs.</li>
<li>Must <a href="https://spectrocoin.com/en/merchant/api/create.html">setup</a> merchant API instance on SpectroCoin API configuration page.</li>
</ul>

<h1>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API</h1>

<ul>
<li><a href="https://spectrocoin.com/api/index.html">Interactive SpectroCoin merchant API operation list</a></li>
<li><a href="https://spectrocoin.com/api/merchant/1/">Root Merchant REST based API address</a></li>
</ul>

<h2>
<a id="createorder" class="anchor" href="#createorder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>/createOrder</h2>

<p>Merchant who wants his customer order to be paid creates order at SpectroCoin with payment details and presents result to his customer. Merchant can also redirect his customer to returned redirect url where customer will be presented with interactive payment window.</p>

<h3>
<a id="request" class="anchor" href="#request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request</h3>

<p>Request URL: <a href="https://spectrocoin.com/api/merchant/1/createOrder">https://spectrocoin.com/api/merchant/1/createOrder</a></p>

<p>For this method server accept only <strong>POST</strong> of <strong>"application/x-www-form-urlencoded"</strong> media type.</p>

<table>
<thead>
<tr>
<th>Seq No.</th>
<th>Field</th>
<th>Type</th>
<th>Required</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.</td>
<td>merchantId</td>
<td>Long</td>
<td>+</td>
<td>12345</td>
</tr>
<tr>
<td>2.</td>
<td>apiId</td>
<td>Long</td>
<td>+</td>
<td>1</td>
</tr>
<tr>
<td>3.</td>
<td>orderId</td>
<td>String</td>
<td>-</td>
<td>ABC001, <strong>Must be unique</strong> for all merchant API orders. If not provided, order request id will be assigned</td>
</tr>
<tr>
<td>4.</td>
<td>payCurrency</td>
<td>String</td>
<td>+</td>
<td>BTC</td>
</tr>
<tr>
<td>5.</td>
<td>payAmount</td>
<td>Double</td>
<td>+ or receiveAmount</td>
<td>123.45, 1.23456789. Amount merchant clients will pay for order in provided pay currency</td>
</tr>
<tr>
<td>6.</td>
<td>receiveCurrency</td>
<td>String</td>
<td>+</td>
<td>BTC, EUR, USD, GBP, SEK, NOK, DKK, PLN, CZK, BGN, GEL, RON, HRK, TRY, CHF and other supported</td>
</tr>
<tr>
<td>7.</td>
<td>receiveAmount</td>
<td>Double</td>
<td>+ or payAmount</td>
<td>123.45, 1.23456789. Value of provided receive currency which merchant want to receive to configured receive account at merchant API setup window</td>
</tr>
<tr>
<td>8.</td>
<td>description</td>
<td>String</td>
<td>-</td>
<td>Order ABC001 for User 123</td>
</tr>
<tr>
<td>9.</td>
<td>payerEmail</td>
<td>String</td>
<td>-</td>
<td>
<a href="mailto:john@spectrocoin.com">john@spectrocoin.com</a> (if API is configured for verified payers only, used to specify who should pay)</td>
</tr>
<tr>
<td>10.</td>
<td>payerName</td>
<td>String</td>
<td>-</td>
<td>John</td>
</tr>
<tr>
<td>11.</td>
<td>payerSurname</td>
<td>String</td>
<td>-</td>
<td>Beard</td>
</tr>
<tr>
<td>12.</td>
<td>culture</td>
<td>String</td>
<td>-</td>
<td>en, lt, ru. Language for response</td>
</tr>
<tr>
<td>13.</td>
<td>callbackUrl</td>
<td>String</td>
<td>-</td>
<td><a href="https://merchant.com/orderCallback?user=123">https://merchant.com/orderCallback?user=123</a></td>
</tr>
<tr>
<td>14.</td>
<td>successUrl</td>
<td>String</td>
<td>-</td>
<td><a href="https://merchant.com/success?user=123">https://merchant.com/success?user=123</a></td>
</tr>
<tr>
<td>15.</td>
<td>failureUrl</td>
<td>String</td>
<td>-</td>
<td><a href="https://merchant.com/failure?user=123">https://merchant.com/failure?user=123</a></td>
</tr>
<tr>
<td>16.</td>
<td>sign</td>
<td>String</td>
<td>+</td>
<td>Generated order request signature</td>
</tr>
</tbody>
</table>

<p>Example HTTP request:</p>

<div class="highlight highlight-source-httpspec"><pre><span class="pl-k">POST</span> https://spectrocoin.com/api/merchant/<span class="pl-c1">1</span>/createOrder HTTP/<span class="pl-c1">1.1</span>
<span class="pl-s"><span class="pl-v">Content-Length:</span> 708</span>
<span class="pl-s"><span class="pl-v">Content-Type:</span> application/x-www-form-urlencoded</span>
<span class="pl-s"><span class="pl-v">Host:</span> spectrocoin.com</span>
<span class="pl-s"><span class="pl-v">Connection:</span> Keep-Alive</span>
<span class="pl-s"><span class="pl-v">Accept-Encoding:</span> gzip,deflate</span>

merchantId<span class="pl-c1">=</span><span class="pl-c1">87</span><span class="pl-c1">&amp;</span><span class="pl-c1">apiId</span><span class="pl-c1">=</span><span class="pl-c1">1</span><span class="pl-c1">&amp;</span><span class="pl-c1">orderId</span><span class="pl-c1">=</span><span class="pl-c1">&amp;</span><span class="pl-c1">payCurrency</span><span class="pl-c1">=</span><span class="pl-c1">BTC</span><span class="pl-c1">&amp;</span><span class="pl-c1">payAmount</span><span class="pl-c1">=</span><span class="pl-c1">0.0</span><span class="pl-c1">&amp;</span><span class="pl-c1">receiveCurrency</span><span class="pl-c1">=</span><span class="pl-c1">USD</span><span class="pl-c1">&amp;</span><span class="pl-c1">receiveAmount</span><span class="pl-c1">=</span><span class="pl-c1">15.99</span><span class="pl-c1">&amp;</span><span class="pl-c1">description</span><span class="pl-c1">=</span><span class="pl-c1">Payment+for+Order-2547</span><span class="pl-c1">&amp;</span><span class="pl-c1">payerEmail</span><span class="pl-c1">=</span><span class="pl-c1">&amp;</span><span class="pl-c1">payerName</span><span class="pl-c1">=</span><span class="pl-c1">&amp;</span><span class="pl-c1">payerSurname</span><span class="pl-c1">=</span><span class="pl-c1">&amp;</span><span class="pl-c1">culture</span><span class="pl-c1">=</span><span class="pl-c1">&amp;</span><span class="pl-c1">callbackUrl</span><span class="pl-c1">=</span><span class="pl-c1">https%3A%2F%2Fmerchant.com%2Fcallback%3Fuser%3D123</span><span class="pl-c1">&amp;</span><span class="pl-c1">successUrl</span><span class="pl-c1">=</span><span class="pl-c1">https%3A%2F%2Fmerchant.com%2Fsuccess%3Fuser%3D123</span><span class="pl-c1">&amp;</span><span class="pl-c1">failureUrl</span><span class="pl-c1">=</span><span class="pl-c1">https%3A%2F%2Fmerchant.com%2Ffailure%3Fuser%3D123</span><span class="pl-c1">&amp;</span><span class="pl-c1">sign</span><span class="pl-c1">=</span><span class="pl-c1">J1lDaNzp7FI%2BkjjDbjHgZ8CUfGJBxoacfTYmNGPG05GCuKQ18erfzookLSapgiUXHz3hzXt3%2FhW4tY5vsYCh6PY7IUgdNC8VjlaNMqtUclMEFc%2Bp1bt%2FttKYYJV35eE9hhiFF7qwQuMEzkrcJKfTmy5uB%2FK07vJBfjP8FHu4ap3kR1XjYYgZgE%2BhrtwKxaWTYZNigt8Y6phlYcaqZPiiUVYInIYov1%2Bahy9pozMXjpYlIMWtEDI8AEYNz8HE%2BYfs1vTUnUDwM72hwRarhpCSz4fKRee%2FNwqq6ZvnXWWKosInzuUynmvHcF8bDjJkxkg72t4BOWBxBrmi4rOYqdQH9A%3D%3D</span></pre></div>

<h3>
<a id="response" class="anchor" href="#response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response</h3>

<p><strong>JSON</strong> formatted response of complex object <code>Order</code>.</p>

<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>orderRequestId</td>
<td>Long</td>
<td>Order request id, SpectroCoin Id to track orders</td>
</tr>
<tr>
<td>orderId</td>
<td>String</td>
<td>ABC001</td>
</tr>
<tr>
<td>payCurrency</td>
<td>String</td>
<td>BTC</td>
</tr>
<tr>
<td>payAmount</td>
<td>Double</td>
<td>123.45, 1.23456789 (BTC)</td>
</tr>
<tr>
<td>receiveCurrency</td>
<td>String</td>
<td>BTC, EUR, ...</td>
</tr>
<tr>
<td>receiveAmount</td>
<td>Double</td>
<td>123.45, 1.23456789 (BTC)</td>
</tr>
<tr>
<td>depositAddress</td>
<td>String</td>
<td>1HZcE7ZbwnEKHYcKkva1uZoxZbFvRyK3fm</td>
</tr>
<tr>
<td>redirectUrl</td>
<td>String</td>
<td><a href="https://spectrocoin.com/en/pay/order/18-5fD2HgMK.html">https://spectrocoin.com/en/pay/order/18-5fD2HgMK.html</a></td>
</tr>
<tr>
<td>validUntil</td>
<td>Long</td>
<td>Timestamp (how many milliseconds have passed since January 1, 1970, 00:00:00 GMT) until order is valid.</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-source-json"><pre>{
<span class="pl-s"><span class="pl-pds">"</span>depositAddress<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>1HZcE7ZbwnEKHYcKkva1uZoxZbFvRyK3fm<span class="pl-pds">"</span></span>,
<span class="pl-s"><span class="pl-pds">"</span>orderId<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>18<span class="pl-pds">"</span></span>,
<span class="pl-s"><span class="pl-pds">"</span>orderRequestId<span class="pl-pds">"</span></span>:<span class="pl-c1">18</span>,
<span class="pl-s"><span class="pl-pds">"</span>payAmount<span class="pl-pds">"</span></span>:<span class="pl-c1">0.00246995</span>,
<span class="pl-s"><span class="pl-pds">"</span>payCurrency<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>BTC<span class="pl-pds">"</span></span>,
<span class="pl-s"><span class="pl-pds">"</span>receiveAmount<span class="pl-pds">"</span></span>:<span class="pl-c1">1.0</span>,
<span class="pl-s"><span class="pl-pds">"</span>receiveCurrency<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>EUR<span class="pl-pds">"</span></span>,
<span class="pl-s"><span class="pl-pds">"</span>redirectUrl<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>https://spectrocoin.com/en/pay/order/18-5fD2HgMK.html<span class="pl-pds">"</span></span>,
<span class="pl-s"><span class="pl-pds">"</span>validUntil<span class="pl-pds">"</span></span>:<span class="pl-c1">1401191587663</span>
}</pre></div>

<h3>
<a id="callback" class="anchor" href="#callback" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Callback</h3>

<p><strong>POST</strong> request to merchant provided order callback url. Request provides information about current order status. Usually there will be several callbacks for a successful order (pending, paid).
Merchant page must return HTTP Response <strong>200</strong> with content: <strong>*ok</strong>* for SpectroCoin API to confirm callback as sent successfully.</p>

<p>Complex object <code>OrderCallback</code>.</p>

<table>
<thead>
<tr>
<th>Seq No.</th>
<th>Field</th>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.</td>
<td>merchantId</td>
<td>Long</td>
<td>12345</td>
</tr>
<tr>
<td>2.</td>
<td>apiId</td>
<td>Long</td>
<td>1</td>
</tr>
<tr>
<td>3.</td>
<td>orderId</td>
<td>String</td>
<td>ABC001</td>
</tr>
<tr>
<td>4.</td>
<td>payCurrency</td>
<td>String</td>
<td>BTC</td>
</tr>
<tr>
<td>5.</td>
<td>payAmount</td>
<td>Double</td>
<td>123.45, 1.23456789 (BTC)</td>
</tr>
<tr>
<td>6.</td>
<td>receiveCurrency</td>
<td>String</td>
<td>BTC, EUR, ...</td>
</tr>
<tr>
<td>7.</td>
<td>receiveAmount</td>
<td>Double</td>
<td>123.45, 1.23456789 (BTC)</td>
</tr>
<tr>
<td>8.</td>
<td>receivedAmount</td>
<td>Double</td>
<td>123.45, 1.23456789 (BTC)</td>
</tr>
<tr>
<td>9.</td>
<td>description</td>
<td>String</td>
<td>Order ABC001 for User 123</td>
</tr>
<tr>
<td>10.</td>
<td>orderRequestId</td>
<td>Long</td>
<td>Order request id, SpectroCoin Id to track orders</td>
</tr>
<tr>
<td>11.</td>
<td>status</td>
<td>Short</td>
<td>Order status</td>
</tr>
<tr>
<td>12.</td>
<td>sign</td>
<td>String</td>
<td>Generated order callback signature</td>
</tr>
</tbody>
</table>

<p>Order status table</p>

<table>
<thead>
<tr>
<th>Status Code</th>
<th>Order status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>New</td>
<td>Start state when order is registered in SpectroCoin system</td>
</tr>
<tr>
<td>2</td>
<td>Pending</td>
<td>Payment (or part of it) was received but still not confirmed</td>
</tr>
<tr>
<td>3</td>
<td>Paid</td>
<td>Order is complete</td>
</tr>
<tr>
<td>4</td>
<td>Failed</td>
<td>Some error occurred</td>
</tr>
<tr>
<td>5</td>
<td>Expired</td>
<td>Payment was not received in time</td>
</tr>
<tr>
<td>6</td>
<td>Test</td>
<td>Test order</td>
</tr>
</tbody>
</table>

<p>Example HTTP request:</p>

<div class="highlight highlight-source-httpspec"><pre><span class="pl-k">POST</span> https://merchant.com/callback HTTP/<span class="pl-c1">1.1</span>
<span class="pl-s"><span class="pl-v">Accept-Encoding:</span> gzip,deflate</span>
<span class="pl-s"><span class="pl-v">Content-Type:</span> application/x-www-form-urlencoded</span>
<span class="pl-s"><span class="pl-v">Content-Length:</span> 578</span>
<span class="pl-s"><span class="pl-v">Host:</span> merchant.com</span>
<span class="pl-s"><span class="pl-v">Connection:</span> Keep-Alive</span>

merchantId<span class="pl-c1">=</span><span class="pl-c1">169</span><span class="pl-c1">&amp;</span><span class="pl-c1">apiId</span><span class="pl-c1">=</span><span class="pl-c1">1</span><span class="pl-c1">&amp;</span><span class="pl-c1">orderId</span><span class="pl-c1">=</span><span class="pl-c1">Order%20123</span><span class="pl-c1">&amp;</span><span class="pl-c1">payCurrency</span><span class="pl-c1">=</span><span class="pl-c1">BTC</span><span class="pl-c1">&amp;</span><span class="pl-c1">payAmount</span><span class="pl-c1">=</span><span class="pl-c1">1.23456789</span><span class="pl-c1">&amp;</span><span class="pl-c1">receiveCurrency</span><span class="pl-c1">=</span><span class="pl-c1">EUR</span><span class="pl-c1">&amp;</span><span class="pl-c1">receiveAmount</span><span class="pl-c1">=</span><span class="pl-c1">50.0</span><span class="pl-c1">&amp;</span><span class="pl-c1">receivedAmount</span><span class="pl-c1">=</span><span class="pl-c1">0.0</span><span class="pl-c1">&amp;</span><span class="pl-c1">description</span><span class="pl-c1">=</span><span class="pl-c1">My%20special%20order</span><span class="pl-c1">&amp;</span><span class="pl-c1">orderRequestId</span><span class="pl-c1">=</span><span class="pl-c1">123</span><span class="pl-c1">&amp;</span><span class="pl-c1">status</span><span class="pl-c1">=</span><span class="pl-c1">1</span><span class="pl-c1">&amp;</span><span class="pl-c1">sign</span><span class="pl-c1">=</span><span class="pl-c1">r6NuZ0JCBSAGCpPlYG5eXLkSRyOqSncWj8j7LfLIiiWeZdeH0Yy2nZ4Osn0JJY9cqWnoT%2Fvn%2B0KjY7f9tdYQjk67XTFY%2Bn1yg41FkzfbDxF8LQWYinLpnBBCf5AlFACJJ26yBHXMxsPFn67khxOV55AGRJeJcw03anH%2FobjevHiOGkV9%2BjTVLwV553U6Y9Ud995D66f45QpPR54IgBBDhA%2BHNlwockLcEyzCMbwMPs0pnsfVO65x0if8TJ2MtwTCa5c%2B%2FuCAq%2BoafTRV9%2Bd9meTRbC%2BFTDf%2FAMyU9SiltpdIqoZPRypB7faBDZ5YVsQrRPIfD6Wy%2FtS6fb8MiFBnOw%3D%3D</span></pre></div>

<h2>
<a id="error-result" class="anchor" href="#error-result" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Error result</h2>

<p>When calling any of API operation, it may result an error.
Errors will be returned <strong>JSON</strong> formatted with <strong>203</strong> http status code.</p>

<div class="highlight highlight-source-json"><pre>[
  {
    <span class="pl-s"><span class="pl-pds">"</span>code<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>,
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>apiId is required<span class="pl-pds">"</span></span>
  },
  {
    <span class="pl-s"><span class="pl-pds">"</span>code<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>,
    <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>merchantId is required<span class="pl-pds">"</span></span>
  }
]</pre></div>

<p>Error codes</p>

<table>
<thead>
<tr>
<th>Error code</th>
<th>Error message</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Validation errors</td>
</tr>
<tr>
<td>2</td>
<td>Bad signature</td>
</tr>
<tr>
<td>3</td>
<td>Not supported currency</td>
</tr>
<tr>
<td>4</td>
<td>Can't create order, please check your merchant account</td>
</tr>
<tr>
<td>5</td>
<td>Merchant order id exist</td>
</tr>
<tr>
<td>6</td>
<td>Check your merchantId and apiId</td>
</tr>
<tr>
<td>97</td>
<td>Unsupported Media Type</td>
</tr>
<tr>
<td>99</td>
<td>Please check your request</td>
</tr>
<tr>
<td>100</td>
<td>Unexpected error</td>
</tr>
</tbody>
</table>

<h1>
<a id="signature" class="anchor" href="#signature" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Signature</h1>

<p>All API requests must be signed using merchant private key so they can be validated by SpectroCoin using merchants public key. Merchant should provide his public key at SpectroCoin merchant API configuration.</p>

<p>Some API request may result in callback from SpectroCoin, such request are also signed by SpectroCoin and must be validated by merchant using <a href="https://spectrocoin.com/files/merchant.public.pem">SpectroCoin Merchant Public Key</a>.</p>

<h2>
<a id="merchant-key-pair" class="anchor" href="#merchant-key-pair" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Merchant key pair</h2>

<p>You should create key pair (private and public keys) (<a href="http://en.wikipedia.org/wiki/Public-key_cryptography">Wiki</a>) for your requests to be signed and validated by SpectroCoin.</p>

<p><strong>Private key</strong> must be kept safely by merchant without any disclosure.</p>

<p><strong>Public key</strong> must be inserted into configuration of specific SpectroCoin API (Create/Edit form of API details). This key will be used to check signature validity of any merchant API request signed by specific merchant and API.</p>

<h3>
<a id="private-and-public-key-generation-using-spectrocoin" class="anchor" href="#private-and-public-key-generation-using-spectrocoin" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Private and public key generation using SpectroCoin</h3>

<p>Open <a href="https://spectrocoin.com/en/merchant/api/create.html">merchant API setup</a> window.
Click Refresh button near "Public Key", new key pair will be generated.
Download private key and keep it safe.
Save merchant API with newly generated public key.</p>

<h3>
<a id="private-key-generation-with-openssl" class="anchor" href="#private-key-generation-with-openssl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Private key generation with OpenSSL</h3>

<div class="highlight highlight-source-shell"><pre><span class="pl-c"># generate a 2048-bit RSA private key</span>
openssl genrsa -out <span class="pl-s"><span class="pl-pds">"</span>C:\private.pem<span class="pl-pds">"</span></span> 2048

<span class="pl-c"># convert private Key to PKCS#8 format (if you use Java)</span>
openssl pkcs8 -topk8 -inform PEM -outform DER -in <span class="pl-s"><span class="pl-pds">"</span>C:\private.pem<span class="pl-pds">"</span></span> -out <span class="pl-s"><span class="pl-pds">"</span>C:\private.der<span class="pl-pds">"</span></span> -nocrypt</pre></div>

<h3>
<a id="public-key-generation-with-openssl" class="anchor" href="#public-key-generation-with-openssl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Public key generation with OpenSSL</h3>

<div class="highlight highlight-source-shell"><pre><span class="pl-c"># output public key portion in PEM format</span>
openssl rsa -in <span class="pl-s"><span class="pl-pds">"</span>C:\private.pem<span class="pl-pds">"</span></span> -pubout -outform PEM -out <span class="pl-s"><span class="pl-pds">"</span>C:\public.pem<span class="pl-pds">"</span></span></pre></div>

<h2>
<a id="signing-request" class="anchor" href="#signing-request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Signing request</h2>

<p>Request to be signed must be converted to <strong>UTF-8 URL encoded concatenated parameters</strong>, consisting of one string line, including parameter names, which are ordered in specific sequence specified in documentation.</p>

<p>Request data which will be signed must be:</p>

<ul>
<li>URL encoded</li>
<li>Spaces must be encoded with "<strong>+</strong>" sign (not "%20"):</li>
</ul>

<pre><code>&amp;description=Some+string
</code></pre>

<ul>
<li>Numbers must be formatted with <strong>0.0#######</strong> number format:</li>
</ul>

<pre><code>null =&gt; 0.0
0 =&gt; 0.0
0.0 =&gt; 0.0
1.1 =&gt; 1.1
1.123 =&gt; 1.123
</code></pre>

<ul>
<li>
<strong>All</strong> request fields should be included for signature generation even if they don't have value set.</li>
</ul>

<p>Example request data to be signed:</p>

<pre><code>merchantId=87&amp;apiId=1&amp;orderId=&amp;payCurrency=BTC&amp;payAmount=0.0&amp;receiveCurrency=USD&amp;receiveAmount=15.99&amp;description=Payment+for+Order-2547&amp;payerEmail=&amp;payerName=&amp;payerSurname=&amp;culture=&amp;callbackUrl=https%3A%2F%2Fmerchant.com%2Fcallback%3Fuser%3D123&amp;successUrl=https%3A%2F%2Fmerchant.com%2Fsuccess%3Fuser%3D123&amp;failureUrl=https%3A%2F%2Fmerchant.com%2Ffailure%3Fuser%3D123
</code></pre>

<p>Signature must be <strong>Base64 encoded</strong>. Example:</p>

<pre><code>J1lDaNzp7FI+kjjDbjHgZ8CUfGJBxoacfTYmNGPG05GCuKQ18erfzookLSapgiUXHz3hzXt3/hW4tY5vsYCh6PY7IUgdNC8VjlaNMqtUclMEFc+p1bt/ttKYYJV35eE9hhiFF7qwQuMEzkrcJKfTmy5uB/K07vJBfjP8FHu4ap3kR1XjYYgZgE+hrtwKxaWTYZNigt8Y6phlYcaqZPiiUVYInIYov1+ahy9pozMXjpYlIMWtEDI8AEYNz8HE+Yfs1vTUnUDwM72hwRarhpCSz4fKRee/Nwqq6ZvnXWWKosInzuUynmvHcF8bDjJkxkg72t4BOWBxBrmi4rOYqdQH9A==
</code></pre>

<h3>
<a id="java-signing" class="anchor" href="#java-signing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Java signing</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">String</span> formValue <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>merchantId=87&amp;apiId=1&amp;orderId=&amp;payCurrency=BTC&amp;payAmount=0.0&amp;receiveCurrency=USD&amp;receiveAmount=15.99&amp;description=Payment+for+Order-2547&amp;payerEmail=&amp;payerName=&amp;payerSurname=&amp;culture=&amp;callbackUrl=https%3A%2F%2Fmerchant.com%2Fcallback%3Fuser%3D123&amp;successUrl=https%3A%2F%2Fmerchant.com%2Fsuccess%3Fuser%3D123&amp;failureUrl=https%3A%2F%2Fmerchant.com%2Ffailure%3Fuser%3D123<span class="pl-pds">"</span></span>;
<span class="pl-smi">Signature</span> ourSign <span class="pl-k">=</span> <span class="pl-smi">Signature</span><span class="pl-k">.</span>getInstance(<span class="pl-s"><span class="pl-pds">"</span>SHA1withRSA<span class="pl-pds">"</span></span>);
ourSign<span class="pl-k">.</span>initSign(privateKey);
ourSign<span class="pl-k">.</span>update(formValue<span class="pl-k">.</span>getBytes());
<span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-smi">BASE64Encoder</span>()<span class="pl-k">.</span>encode(ourSign<span class="pl-k">.</span>sign());</pre></div>

<h3>
<a id="php-signing" class="anchor" href="#php-signing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PHP signing</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>merchantId=87&amp;apiId=1&amp;orderId=&amp;payCurrency=BTC&amp;payAmount=0.0&amp;receiveCurrency=USD&amp;receiveAmount=15.99&amp;description=Payment+for+Order-2547&amp;payerEmail=&amp;payerName=&amp;payerSurname=&amp;culture=&amp;callbackUrl=https%3A%2F%2Fmerchant.com%2Fcallback%3Fuser%3D123&amp;successUrl=https%3A%2F%2Fmerchant.com%2Fsuccess%3Fuser%3D123&amp;failureUrl=https%3A%2F%2Fmerchant.com%2Ffailure%3Fuser%3D123<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-c">// fetch private key from file and ready it</span></span>
<span class="pl-s1"><span class="pl-smi">$private_pem_key</span> <span class="pl-k">=</span> <span class="pl-c1">openssl_pkey_get_private</span>(<span class="pl-smi">$path_to_private_key</span>);</span>
<span class="pl-s1"><span class="pl-c">// compute signature</span></span>
<span class="pl-s1"><span class="pl-c1">openssl_sign</span>(<span class="pl-smi">$data</span>, <span class="pl-smi">$signature</span>, <span class="pl-smi">$private_pem_key</span>, <span class="pl-c1">OPENSSL_ALGO_SHA1</span>);</span>
<span class="pl-s1"><span class="pl-smi">$encodedSignature</span> <span class="pl-k">=</span> <span class="pl-c1">base64_encode</span>(<span class="pl-smi">$signature</span>);</span></pre></div>

<h2>
<a id="validating-callbacks" class="anchor" href="#validating-callbacks" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Validating callbacks</h2>

<p>Requests coming from SpectroCoin to merchant pages are also signed. Merchant must validate signature of the request.
Request signature to be validated must be <strong>Base64 decoded</strong>.
Request must be converted to <strong>UTF-8 URL encoded concatenated parameters</strong> of one string line including parameter names and ordered in specific sequence specified in documentation.</p>

<h3>
<a id="java-validation" class="anchor" href="#java-validation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Java validation</h3>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">String</span> parameters <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>merchantId=25&amp;apiId=25&amp;orderId=L254S&amp;payCurrency=BTC&amp;payAmount=25.0&amp;receiveCurrency=EUR&amp;receiveAmount=245.0&amp;description=Some+sting+with+symbols+%25%3D%26&amp;orderRequestId=11&amp;status=1<span class="pl-pds">"</span></span>;
<span class="pl-smi">String</span> responseSign <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>qGy2ablxcWtoGVAS2YufkYVWT0jLSilaUtMkz6Z8P6Mn6qInewEfK5Bsn4BFRxg1suENJJF8LJGyJV6vZt3XLmAHoTJwRjWLij2FROdFthuVt/U4Ima6uFm6hkjseeNLvJtdLFYWSAyKkt7wpeLPA2QUspQbG0asOhwd8EeP+mZDSfvOwTv2OFvGWcVEPR6DOWKEaw5wW6ilM8yZKowQzhrqoCUyJN4pxK02PLTKGIb6YDu1nESrN6ebp7ugskYwcmynLWNOY8Tu1bdg0fWBF2uCgJkWpc9yy2UYbtpVO7sCjIe+dmojJzqCwS5/7Ny04Mf+ouj6oEchxHfUq7VpaA==<span class="pl-pds">"</span></span>;
<span class="pl-smi">Signature</span> verifier <span class="pl-k">=</span> <span class="pl-smi">Signature</span><span class="pl-k">.</span>getInstance(<span class="pl-s"><span class="pl-pds">"</span>SHA1withRSA<span class="pl-pds">"</span></span>);
verifier<span class="pl-k">.</span>initVerify(publicKey);
verifier<span class="pl-k">.</span>update(parameters<span class="pl-k">.</span>getBytes());
<span class="pl-k">byte</span>[] bytes <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BASE64Decoder</span>()<span class="pl-k">.</span>decodeBuffer(responseSign);
<span class="pl-k">return</span> verifier<span class="pl-k">.</span>verify(bytes);</pre></div>

<h3>
<a id="php-validation" class="anchor" href="#php-validation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PHP validation</h3>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>merchantId=25&amp;apiId=25&amp;orderId=L254S&amp;payCurrency=BTC&amp;payAmount=25.0&amp;receiveCurrency=EUR&amp;receiveAmount=245.0&amp;description=Some+sting+with+symbols+%25%3D%26&amp;orderRequestId=11&amp;status=1<span class="pl-pds">"</span></span>;</span>
<span class="pl-s1"><span class="pl-smi">$encodedSignature</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>QKpoaBL/P2tcFttFm/TVcn0utkgaOzEAOsZbSSOa+zntcxyJUijaM5egewRoRu68d4CoswTpkdOqaKdGrLWPNqQGujPHIX3q8Q0lK/C8GqN7MYHFrLxu+rpY0G4srIaDzXww4uOTkBIBFWn3TVI4AZAGm0/APlZZeCrhwIIkImYc8ab69zeqikyaMXRK0XMAD/8Fz9b+rUR342hMjFR+epZnNmWQpFtQLvB/SxlCZIZ+u1k2WLJYa7CChDePmdXNHgutvt1mQxLMpJmeDNjD2aOzF9+DPIqsOEkJ9RLJ8F0kQXnn9W02Av/a3GMVC7A/u/kxnKo3LRfkkkAAYkCKug==<span class="pl-pds">"</span></span></span>
<span class="pl-s1"><span class="pl-smi">$public_key_pem</span> <span class="pl-k">=</span> <span class="pl-c1">openssl_pkey_get_public</span>(<span class="pl-smi">$path_to_public_spectro_coin_key</span>);</span>
<span class="pl-s1"><span class="pl-smi">$responseDecodedSign</span> <span class="pl-k">=</span> <span class="pl-c1">base64_decode</span>(<span class="pl-smi">$encodedSignature</span>);</span>
<span class="pl-s1"><span class="pl-smi">$validity</span> <span class="pl-k">=</span> <span class="pl-c1">openssl_verify</span>(<span class="pl-smi">$data</span>, <span class="pl-smi">$responseDecodedSign</span>, <span class="pl-smi">$public_key_pem</span>, <span class="pl-c1">OPENSSL_ALGO_SHA1</span>);</span></pre></div>

<h1>
<a id="example-applications" class="anchor" href="#example-applications" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example applications</h1>

<p>There are several sample SpectroCoin merchant API client applications. You should customize them for your needs.</p>

<h2>
<a id="java" class="anchor" href="#java" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Java</h2>

<p>Sample Java application could be found <a href="https://github.com/SpectroFinance/SpectroCoin-Merchant-Java">here</a>.</p>

<h2>
<a id="php" class="anchor" href="#php" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PHP</h2>

<p>Sample PHP application could be found <a href="https://github.com/SpectroFinance/SpectroCoin-Merchant-PHP">here</a>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/SpectroFinance/SpectroCoin-Merchant-API">SpectroCoin Merchant API</a> is maintained by <a href="https://github.com/SpectroFinance">SpectroFinance</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-51179757-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
